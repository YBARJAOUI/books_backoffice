<!-- src/app/features/books/book-list/book-list.component.html -->
<div class="book-list-container">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="page-header">
      <i class="pi pi-book me-2"></i>
      Gestion des Livres
    </h2>
    <button 
      class="btn btn-primary"
      (click)="addBook()">
      <i class="pi pi-plus me-2"></i>
      Nouveau Livre
    </button>
  </div>

  <!-- Filters Card -->
  <div class="custom-card mb-4">
    <div class="card-body">
      <div class="row g-3 align-items-end">
        <div class="col-md-4">
          <label class="form-label">Rechercher</label>
          <div class="input-group">
            <input 
              type="text" 
              class="form-control"
              placeholder="Titre, auteur, ISBN..."
              [(ngModel)]="searchValue"
              (keyup.enter)="onSearchChange()">
            <button 
              class="btn btn-outline-primary"
              type="button"
              (click)="onSearchChange()">
              <i class="pi pi-search"></i>
            </button>
          </div>
        </div>

        <div class="col-md-3">
          <label class="form-label">Catégorie</label>
          <select 
            class="form-select"
            [(ngModel)]="selectedCategory"
            (change)="onCategoryChange()">
            <option value="">Toutes les catégories</option>
            <option *ngFor="let category of categories" [value]="category">
              {{ category }}
            </option>
          </select>
        </div>

        <div class="col-md-3">
          <button 
            class="btn btn-outline-secondary me-2"
            (click)="clearFilters()">
            <i class="pi pi-filter-slash me-2"></i>
            Effacer filtres
          </button>
        </div>

        <div class="col-md-2">
          <button 
            class="btn btn-success"
            (click)="exportExcel()">
            <i class="pi pi-file-excel me-2"></i>
            Export
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Data Table -->
  <div class="custom-card">
    <div class="card-body p-0">
      <p-table 
        #dt
        [value]="books"
        [loading]="loading"
        [paginator]="true"
        [rows]="rows"
        [totalRecords]="totalRecords"
        [lazy]="true"
        (onLazyLoad)="loadBooks($event)"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Affichage de {first} à {last} sur {totalRecords} livres"
        [rowsPerPageOptions]="[10, 25, 50]"
        styleClass="p-datatable-striped p-datatable-gridlines"
        responsiveLayout="stack"
        [breakpoint]="'768px'">

        <!-- Toolbar -->
        <ng-template pTemplate="caption">
          <div class="table-toolbar d-flex justify-content-between align-items-center">
            <span class="table-title">
              Liste des Livres ({{ totalRecords }} résultats)
            </span>
            <div class="table-actions">
              <button 
                class="btn btn-sm btn-outline-primary me-2"
                (click)="dt.exportCSV()">
                <i class="pi pi-download me-2"></i>
                CSV
              </button>
            </div>
          </div>
        </ng-template>

        <!-- Table Headers -->
        <ng-template pTemplate="header">
          <tr>
            <th style="width: 80px">Image</th>
            <th pSortableColumn="title">
              Titre <p-sortIcon field="title"></p-sortIcon>
            </th>
            <th pSortableColumn="author">
              Auteur <p-sortIcon field="author"></p-sortIcon>
            </th>
            <th>Catégorie</th>
            <th pSortableColumn="price">
              Prix <p-sortIcon field="price"></p-sortIcon>
            </th>
            <th pSortableColumn="stockQuantity">
              Stock <p-sortIcon field="stockQuantity"></p-sortIcon>
            </th>
            <th>Statut</th>
            <th style="width: 200px">Actions</th>
          </tr>
        </ng-template>

        <!-- Table Body -->
        <ng-template pTemplate="body" let-book>
          <tr>
            <td>
              <div class="book-image">
                <img 
                  *ngIf="book.imageUrl" 
                  [src]="book.imageUrl" 
                  [alt]="book.title"
                  class="book-thumbnail"
                  onerror="this.src='assets/images/book-placeholder.png'">
                <div 
                  *ngIf="!book.imageUrl" 
                  class="book-placeholder">
                  <i class="pi pi-image"></i>
                </div>
              </div>
            </td>
            
            <td>
              <div class="book-info">
                <strong class="book-title">{{ book.title }}</strong>
                <div class="book-meta">
                  <small class="text-muted">ISBN: {{ book.isbn }}</small>
                  <span 
                    *ngIf="book.isFeatured" 
                    class="badge bg-warning ms-2">
                    <i class="pi pi-star-fill me-1"></i>Vedette
                  </span>
                </div>
              </div>
            </td>
            
            <td>
              <span class="author-name">{{ book.author }}</span>
            </td>
            
            <td>
              <span class="badge bg-info" *ngIf="book.category">
                {{ book.category }}
              </span>
              <span class="text-muted" *ngIf="!book.category">-</span>
            </td>
            
            <td>
              <strong class="price">{{ book.price | currency:'EUR':'symbol':'1.2-2' }}</strong>
            </td>
            
            <td>
              <span 
                class="badge"
                [class]="'bg-' + getStockSeverity(book.stockQuantity)">
                {{ book.stockQuantity }}
              </span>
              <button 
                *ngIf="book.stockQuantity <= 10"
                class="btn btn-sm btn-link text-warning ms-1"
                title="Stock faible">
                <i class="pi pi-exclamation-triangle"></i>
              </button>
            </td>
            
            <td>
              <span 
                class="badge"
                [class]="'bg-' + getStatusSeverity(book.isActive!)">
                {{ book.isActive ? 'Actif' : 'Inactif' }}
              </span>
            </td>
            
            <td>
              <div class="action-buttons">
                <button 
                  class="btn btn-sm btn-outline-primary me-1"
                  (click)="editBook(book)"
                  title="Modifier">
                  <i class="pi pi-pencil"></i>
                </button>
                
                <button 
                  class="btn btn-sm"
                  [class]="book.isFeatured ? 'btn-warning' : 'btn-outline-warning'"
                  (click)="toggleFeatured(book)"
                  [title]="book.isFeatured ? 'Retirer des favoris' : 'Ajouter aux favoris'">
                  <i class="pi pi-star" [class.pi-star-fill]="book.isFeatured"></i>
                </button>
                
                <button 
                  class="btn btn-sm btn-outline-danger ms-1"
                  (click)="deleteBook(book)"
                  title="Supprimer">
                  <i class="pi pi-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        </ng-template>

        <!-- Empty State -->
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="8" class="text-center py-5">
              <div class="empty-state">
                <i class="pi pi-book empty-icon"></i>
                <h5>Aucun livre trouvé</h5>
                <p class="text-muted">Commencez par ajouter votre premier livre</p>
                <button 
                  class="btn btn-primary"
                  (click)="addBook()">
                  <i class="pi pi-plus me-2"></i>
                  Ajouter un livre
                </button>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</div>

<!-- Toast Messages -->
<p-toast></p-toast>

<!-- Confirmation Dialog -->
<p-confirmDialog></p-confirmDialog>